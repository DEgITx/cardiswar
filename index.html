<head>
<script src="/socket.io/socket.io.js"></script>
<script src="/js/phaser.js"></script>
<style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }

        canvas {
            width   : 100%;
            height  : 100%;
            /* touch-action: none; */
        }
    </style>
<script>
  var socket = io('http://localhost:8099');  
  
  window.addEventListener('DOMContentLoaded', function(){
      var players;
	  var player;
	  var map;
	  var playersCursor = {};
	  var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
	    
	  socket.on('join', function (data) {
			players = data.map.players;
			player = data.player;
			console.log('Me with id ' + data.player.id + ' joined');
			moneyText.text = 'money: ' + data.player.money;
			map = data.map.map;
			for(var i = 0; i < data.map.map.length; i++)
			{
				var graphics = game.add.graphics(100, 100);
				graphics.lineStyle(2, 0x0000FF, 1);
				graphics.drawRect(data.map.map[i].x, data.map.map[i].y, data.map.map[i].height, data.map.map[i].width);
				data.map.map[i].playerids.forEach(function(id, j){
					let sep = data.map.map[i].width/data.map.map[i].playerids.length;
					let tr = sep * j + sep / 2;
					playersCursor[id] = game.add.graphics(100, 100);
					playersCursor[id].lineStyle(2, 0xFF00FF, 1);
					playersCursor[id].drawCircle(data.map.map[i].x + tr , data.map.map[i].y + data.map.map[i].height / 2, 5);
				});
			}
			
			socket.on('joinplayer', function (data) {
				console.log('Player ' + data.player.id + ' join');
			});
			
			socket.on('leftplayer', function (data) {
				console.log('Player ' + data.player.id + ' left');
				delete players[data.player.id];
			});
			
			socket.on('makestep', function(data){
				var prevx
				data.path.forEach(function(path){
					playersCursor[data.player.id].x += 10 ;
				});
			});
	  });

		function preload() {
			
		}

		function create() {		
			moneyText = game.add.text(16, 16, 'money: 0', { fontSize: '32px', fill: '#fff' });
			diceText = game.add.text(500, 16, 'dice: 0', { fontSize: '32px', fill: '#fff' });
			
			stepButton = game.add.button(game.world.centerX - 95, 400, 'button', function(){
				socket.emit('makestep', {});
			}, this, 2, 1, 0);
		}

		function update() {
			
		}

  });
</script>
</head>